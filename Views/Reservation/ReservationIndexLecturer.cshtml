@model LectureRoomMgt.Models.Reservation.RoomReservationVM
@using Kendo.Mvc.UI
@using LectureRoomMgt.Models.Reservation

<link href="~/custom/css/kendo.bootstrap-main.css" rel="stylesheet" />
<script src="~/custom/js/jszip.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_jquery.min.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_kendo.all.min.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_kendo.aspnetmvc.min.js"></script>

<script src="@Url.Content("~/scheduler/pako.min.js")"></script>

<style>
    .k-scheduler {
        font-family: "DejaVu Sans", "Arial", sans-serif;
    }

    .k-pdf-export .k-scheduler-toolbar,
    .k-pdf-export .k-scheduler-navigation .k-nav-today,
    .k-pdf-export .k-scheduler-navigation .k-nav-prev,
    .k-pdf-export .k-scheduler-navigation .k-nav-next,
    .k-pdf-export .k-scheduler-footer {
        display: none;
    }

    .movie-template img {
        float: left;
        margin: 0 8px;
    }

    .movie-template p {
        margin: 5px 0 0;
    }

    .movie-template h3 {
        padding: 0 8px 5px;
        font-size: 12px;
    }

    .movie-template a {
        color: #ffffff;
        font-weight: bold;
        text-decoration: none;
    }

        .k-state-hover .movie-template a,
        .movie-template a:hover {
            color: #000000;
        }

    body, h1, h2, h3 {
        margin: 0px;
    }
</style>


<div class="row">
    <div class="col-12">
        <div class="form-row mb-2">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-globe"></i>
                    Rooms Booking
                </h3>
            </div>

            <div class="card-footer col-12">

                <div class="row">
                    <div>
                        <div class="mt-2">
                            <a href="@Url.Action("IndexBookRooms","Reservation",new {facId = ViewBag.FacultyId, blockId = ViewBag.BlockId, floorId = ViewBag.FloorId})" class="btn btn-info btn-sm" data-toggle="tooltip" data-placement="bottom" title="Back "><i class="fa fa-save"></i> Back</a>
                        </div>
                    </div>
                </div>


                <div class="form-row">

                    <input type="hidden" asp-for="LecturerId" value="@ViewBag.LecturerId" />
                    <input type="hidden" asp-for="FacultyId" value="@ViewBag.FacultyId" />
                    <input type="hidden" asp-for="BlockId" value="@ViewBag.BlockId" />
                    <input type="hidden" asp-for="FloorId" value="@ViewBag.FloorId" />
                    <input type="hidden" asp-for="RoomId" value="@ViewBag.RoomId" />

                    <div class="form-group col-6 offset-3">
                        <label class="form-label">Course</label><br />
                        <select asp-for="CourseId" asp-items="@ViewBag.Courses as SelectList" class="form-control col-12">
                            <option value="">Please select</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row" id="schedulerPane" style="display:none">
    <div class="col-12">
        <div class="form-row mb-2">
            <div class="card-footer col-12" style="text-align:center">
                <div class="form-row">
                    @(Html.Kendo().Scheduler<LectureRoomMgt.Models.Reservation.RoomReservationVM>()
                        .Name("scheduler")
                        .Date(DateTime.Now)
                        .StartTime(new DateTime(2017, 1, 1, 6, 00, 00))
                        .Height(600)
                        .HtmlAttributes(new { style = "width:100%" })
                        .Pdf(pdf => pdf
                            .FileName("Booking.pdf")
                            .ProxyURL(Url.Action("Pdf_Export_Save", "Grid"))
                        )
                        .Toolbar(t =>
                        { t.Pdf(); t.Search(); }
                        )
                        .EventTemplate(
                                    "<div class='movie-template'>" +
                                        "<img src='" + Url.Content("~/scheduler/") + "#= Image #' />" + "<h3>#= RoomName #</h3>" +
                                        "<p>" +
                                            "#= kendo.toString(start, 'hh:mm') # - #= kendo.toString(end, 'hh:mm') #" +
                                        "</p>" +
                                        "<h3>#= title #</h3>" +
                                    "</div>")
                       .Views(views =>
                       {
                           views.DayView();
                           views.WeekView();
                           views.MonthView();
                           views.AgendaView();
                       })
                        .Timezone("Etc/UTC")
                        .DataSource(d => d
                            .Events(e => e.Error("onError"))
                            .Model(m =>
                            {
                                m.Id(f => f.ReservationId);
                                m.Field(f => f.Title).DefaultValue("No title");
                                m.Field(f => f.Start);
                                m.Field(f => f.RoomId);
                                m.RecurrenceId(f => f.RecurrenceID);
                            })
                            .Read(read => read.Action("Schedules_Read", "Reservation").Data("additionalData"))
                            .Create(create => create.Action("Schedules_Create", "Reservation").Data("additionalData"))
                            .Update(update => update.Action("Schedules_Update", "Reservation").Data("additionalData"))
                            .Destroy(destroy => destroy.Action("Schedules_Destroy", "Reservation").Data("additionalData"))
                        )
                    )
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

        $('#CourseId').change(function () {
            debugger;
            event.preventDefault();

            $('#schedulerPane').hide();

            if ($('#CourseId :selected').val() != "") {

                var scheduler = $("#scheduler").data("kendoScheduler");
                scheduler.dataSource.read();

                $('#schedulerPane').show();
            }
        });


    });

</script>

<script id="event-template" type="text/x-kendo-template">
    <div class="movie-template">
        <h3>#= title #</h3>
        # if (Image) { #
        <img src="@Url.Content("~/scheduler/" + "#= Image #")" />
        # } #
        <br><p>#= kendo.toString(start, 'hh:mm') # - #= kendo.toString(end, 'hh:mm') #</p>
        <p>#= RoomName #</p>
    </div>
</script>


<script type="text/javascript">
    function onError(e) {
        this.cancelChanges();
        var errorMessage = "Error has happened!";
        if (e.errors) {
            for (var error in e.errors) {
                errorMessage += e.errors[error].errors[0] + " ";
            }
        }
        alert(errorMessage);
    }

    function additionalData() {
        var value1 = $('#RoomId').val();
        var value2 = $('#LecturerId').val();
        var value3 = $('#CourseId :selected').val();

        return { roomId: value1, lecId: value2, courseId: value3 };
    }
</script>
