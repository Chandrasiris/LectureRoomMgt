@{ 
    ViewBag.Title = "Courses";

    var ModClaimCheck = true;
    var DelClaimCheck = true;
    var NewClaimCheck = true;
}

@using Kendo.Mvc.UI
@using Kendo.Mvc


<link href="~/custom/css/kendo.bootstrap-main.css" rel="stylesheet" />
<script src="~/custom/js/jszip.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_jquery.min.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_kendo.all.min.js"></script>
<script src="~/custom/js/2023/kendo.cdn.telerik.com_2023.2.606_js_kendo.aspnetmvc.min.js"></script>


<style>
    .k-grid tbody tr {
        line-height: 14px;
    }

    .k-grid tbody td {
        padding: 5px;
    }

    .k-grid-save-changes:hover {
        background-color: #5cb85c;
    }

    .k-grid-delete-custom {
        background-color: tomato;
    }

    .k-grid-cancel-changes:hover {
        background-color: red;
    }

    .k-grid-excel:hover {
        background-color: forestgreen;
    }

    .k-grid-pdf:hover {
        background-color: red;
    }

    .k-grid .k-grid-toolbar .k-grid-add,
    .k-grid .k-grid-toolbar .k-grid-save-changes,
    .k-grid .k-grid-toolbar .k-grid-cancel-changes,
    .k-grid .k-grid-toolbar .k-grid-delete-custom {
        min-width: 0;
    }

        .k-grid .k-grid-toolbar .k-grid-add .k-icon,
        .k-grid .k-grid-toolbar .k-grid-save-changes .k-icon,
        .k-grid .k-grid-toolbar .k-grid-cancel-changes .k-icon,
        .k-grid .k-grid-toolbar .k-grid-delete-custom .k-icon {
            margin: 0;
        }
</style>

<div class="row">
    <div class="col-12">

        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-book-open"></i>
                    Courses
                </h3>
            </div>

            <div class="card-body">
                @(Html.Kendo().Grid<LectureRoomMgt.Models.Courses.CourseVM>()
                .Name("CoursesGrid")
                .Columns(columns =>
                {
                    columns.Select().Width(40).HeaderHtmlAttributes(new { @style = "text-align:center" }).HtmlAttributes(new { @style = "text-align:center" });
                    columns.Bound(p => p.Code).Title("Code");
                    columns.Bound(p => p.CourseName);
                    columns.Bound(p => p.Comment);
                    columns.Bound(p => p.Id).Hidden();
                })
                        .ToolBar(toolbar =>
                        {
                            if (NewClaimCheck)
                            {
                                toolbar.Create().Text(" ").HtmlAttributes(new { @class = "bg-info" });
                            }
                            toolbar.Save().Text(" ").CancelText(" ");
                            {
                                if (DelClaimCheck)
                                {
                                    toolbar.Custom().Text(" ").IconClass("k-icon k-i-trash").HtmlAttributes(new { @class = "k-grid-delete-custom" });
                                }
                            }

                            toolbar.Excel().Text("Excel").HtmlAttributes(new { @class = "ml-5" });
                            toolbar.Pdf().Text("Pdf");
                            toolbar.Search();
                        })
                .Selectable(selectable => selectable.Mode(GridSelectionMode.Multiple))
                .Editable(editable =>
                {
                    if (ModClaimCheck)
                    {
                        editable.Mode(GridEditMode.InCell).DisplayDeleteConfirmation(false);
                    }
                })
                .Pageable()
                .ColumnMenu(col => col.Filterable(false))
                .Navigatable()
                .Sortable()
                .Scrollable()
                .Resizable(resize => resize.Columns(true))
                .Reorderable(r => r.Columns(true))
                .Filterable()
                .DataSource(dataSource => dataSource
                      .Ajax()
                      .Batch(true)
                      .PageSize(15)
                      .ServerOperation(false)
                      .Events(events => events.Error("course_err"))
                      .Model(model =>
                      {
                          model.Id(block => block.Id);
                      })
                      //.Aggregates(aggregates =>
                      //   {
                      //       aggregates.Add(p => p.FacultyName).Count();
                      //})
                      .Create(create => create.Action("CreateCourse", "Course"))
                      .Read(read => read.Action("LoadCourses", "Course"))
                      .Update(update => update.Action("EditCourse", "Course"))
                      .Destroy(destroy => destroy.Action("DeleteCourse", "Course"))
                   )
                )
            </div>
        </div>
    </div>
</div>

<script>

    $("#CoursesGrid").on("click", ".k-grid-delete-custom", function (e) {
        e.preventDefault();

        var grid = $("#CoursesGrid").data("kendoGrid");
        grid.select().each(function () {
            grid.removeRow($(this));
        });
    });


    function course_err(e) {
        if (e.errors) {
            var message = "";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "</br>";
                    });
                }
            });
            toastr.error(message);
        }
    }
</script>
